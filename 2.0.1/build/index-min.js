KISSY.add("kg/datalazyload/2.0.0/index",function(a,b,c,d,e){function r(a){var b,c,e,d=[];return function(f,g){return 0===g||g||(g=1),1&g&&!c&&(c=!0,a(function(a){for(b=a;e=d.shift();)try{e&&e.apply(null,[b])}catch(c){setTimeout(function(){throw c},0)}})),b?(f&&f.apply(null,[b]),b):(2&g||f&&d.push(f),b)}}function s(b,c,d){function h(){e&&(e.cancel(),e=0),f=a.now(),b.apply(d||this,arguments),g=a.now()}var e,f=0,g=0,c=c||150;return a.mix(function(){!f||g>=f&&a.now()-g>c||f>g&&a.now()-f>8*c?h():(e&&e.cancel(),e=a.later(h,c,0,null,arguments))},{stop:function(){e&&(e.cancel(),e=0)}})}function w(c,d,e){var f,g,h;return c.style.display=l,c.className="",f=b.create("<div>"),c.parentNode.insertBefore(f,c),g=c.value,a.isFunction(e)&&(h=e({type:"textarea",elem:c,value:g}),h&&(g=h)),b.html(f,g,d),f}function x(a){return a._ks_lazy_width?a._ks_lazy_width:a._ks_lazy_width=b.outerWidth(a)}function y(a){return a._ks_lazy_height?a._ks_lazy_height:a._ks_lazy_height=b.outerHeight(a)}function z(a,c,d){if(!a.offsetWidth)return!1;var g,e=b.offset(a),f=!0,h=e.left,i=e.top,j={left:h,top:i,right:h+x(a),bottom:i+y(a)};return g=B(c,j),g&&d&&(f=B(d,j)),f&&g}function A(b,c){var e,d=this;return d instanceof A?(e=b,a.isPlainObject(e)||(e=c||{},b&&(e.container=b)),A.superclass.constructor.call(d,e),d._callbacks={},d._containerIsNotDocument=9!=d.get("container").nodeType,a.isArray(e.container)&&(d._backCompact=1),d["_initLoadEvent"](),e.container&&d.addElements(e.container),d._loadFn(),a.ready(function(){d._loadFn()}),d.resume(),void 0):new A(b,c)}function B(a,b){var c={};return c.top=Math.max(a.top,b.top),c.bottom=Math.min(a.bottom,b.bottom),c.left=Math.max(a.left,b.left),c.right=Math.min(a.right,b.right),c.bottom>=c.top&&c.right>=c.left}function C(a){if(a.naturalWidth)return a.naturalWidth;var b=new Image;return b.src=a.src,b.width}function E(c,d,e,f){"img-src"===d&&(d="img"),a.isArray(c)||(c=[b.get(c)]);var k=new A(g,{});k.set("imgFlag",e||h+j),k.set("areaFlag",e||i+j),k.set("onStart",f),k.set("force",!0),k.addElements(c,d)}var f=a.Env.host,g=f.document,h="data-ks-lazyload",i="ks-datalazyload",j="-custom",k="default",l="none",m="scroll",n="touchmove",o="resize",p=100,q=0,t=function(a){var c,d;b.hasAttr(a,"width")&&(c=b.attr(a,"width"),b.attr(a,"_width",c),b.removeAttr(a,"width")),b.hasAttr(a,"height")&&(d=b.attr(a,"height"),b.attr(a,"_height",d),b.removeAttr(a,"height"))},u=function(a){var d,f,g;try{d=a.currentTarget||a.srcElement||a.target}catch(e){}d||(d=a),b.hasAttr(d,"_width")&&(f=b.attr(d,"_width"),b.attr(d,"width",f),b.removeAttr(d,"_width")),b.hasAttr(d,"_height")&&(g=b.attr(d,"_height"),b.attr(d,"height",g),b.removeAttr(d,"_height"));try{c.detach(d,"load",u)}catch(e){}},v=function(d,e,f,g){function l(a){d.src!=a&&(d.src=a),d.removeAttribute(e)}e=e||h;var i=d.getAttribute(e),j={type:"img",elem:d,src:i},k=!a.isFunction(f)||f(j)!==!1;k&&j.src&&(a.isFunction(g)?a.use("./plugin/webp",function(a,b){b.isSupport(function(a){l(a?g(j.src):j.src)})}):((b.hasAttr(d,"_width")||b.hasAttr(d,"_height"))&&c.on(d,"load",u),l(j.src)))};return A.ATTRS={diff:{value:k},placeholder:{value:"//g.alicdn.com/s.gif"},execScript:{value:!0},container:{setter:function(c){return c=c||g,a.isWindow(c)?c=c.document:(c=b.get(c),"body"==b.nodeName(c)&&(c=c.ownerDocument)),c},valueFn:function(){return g}},autoDestroy:{value:!0},onStart:{value:null}},a.extend(A,d,{_initLoadEvent:function(){var b=this,c=b.get("autoDestroy");b.imgHandle=function(){v(this,b.get("imgFlag"),b.get("onStart"),b.get("webpReplacer"))},b.textareaHandle=function(){b.addElements(w(this,b.get("execScript"),b.get("onStart")))},b._loadFn=s(function(){c&&0==b._counter&&a.isEmptyObject(b._callbacks)&&b.destroy(),b["_loadItems"]()},p,b)},refresh:function(){this._loadFn()},_loadItems:function(){var b=this,c=b.get("container");(!b._containerIsNotDocument||c.offsetWidth)&&(b._windowRegion=b["_getBoundingRect"](),!b._backCompact&&b._containerIsNotDocument&&(b._containerRegion=b["_getBoundingRect"](b.get("container"))),a.each(b._callbacks,function(a,c){a&&b._loadItem(c,a)}))},_loadItem:function(a,b){var d,e,f,c=this;if(b=b||c._callbacks[a],!b)return!0;if(d=b.el,e=!1,f=b.fn,c.get("force")||z(d,c._windowRegion,c._containerRegion))try{e=f.call(d)}catch(g){setTimeout(function(){throw g},0)}return e!==!1&&delete c._callbacks[a],e},addCallback:function(c,d){c=b.get(c);var e=this,f=e._callbacks,g={el:c||document,fn:d||a.noop},h=++q;f[h]=g,e._windowRegion?e._loadItem(h,g):e.refresh()},removeCallback:function(c,d){c=b.get(c);var e=this._callbacks;a.each(e,function(a,b){a.el==c&&(d?a.fn==d:1)&&delete e[b]})},getElements:function(){var b=this,c=[],d=[],e=b._callbacks;return a.each(e,function(a){a.fn==b.imgHandle&&c.push(a.el),a.fn==b.textareaHandle&&d.push(a.el)}),{images:this._images,textareas:this._textareas}},addElements:function(c,d){"string"==typeof c?c=b.query(c):a.isArray(c)||(c=[c]);var e=this;e._counter=e._counter||0,a.each(c,function(c){d&&"img"!==d||a.each(a.filter([c].concat(b.query("img",c)),function(a){return a.getAttribute&&a.getAttribute(e.get("imgFlag")||h)},e),function(a){e.onPlaceHolder=e.onPlaceHolder||r(function(a){var b=new Image,c=e.get("placeholder");b.src=c,b.onload=b.onerror=function(){a(c)}}),C(a)?e.addCallback(a,e.imgHandle):(e._counter++,a.onload=function(){e._counter--,e.addCallback(a,e.imgHandle)},a.src||e.onPlaceHolder(function(b){a.src||(t(a),a.src=b)}))}),d&&"textarea"!==d||a.each(b.query("textarea."+(e.get("areaFlag")||i),c),function(a){e.addCallback(a,e.textareaHandle)})})},removeElements:function(c){"string"==typeof c?c=b.query(c):a.isArray(c)||(c=[c]);var d=this,e=d._callbacks;a.each(e,function(b,d){a.inArray(b.el,c)&&delete e[d]})},_getBoundingRect:function(c){var d,f,g,h,i,j,l,m,n,o,p,q,r,s;return c!==e?(d=b.outerHeight(c),f=b.outerWidth(c),i=b.offset(c),g=i.left,h=i.top):(d=b.viewportHeight(),f=b.viewportWidth(),g=b.scrollLeft(),h=b.scrollTop()),j=this.get("diff"),l=j===k?f:j,m=0,n=l,o=j===k?d:j,p=0,q=o,r=g+f,s=h+d,a.isObject(j)&&(m=j.left||0,n=j.right||0,p=j.top||0,q=j.bottom||0),g-=m,r+=n,h-=p,s+=q,{left:g,top:h,right:r,bottom:s}},pause:function(){var d,a=this,b=a._loadFn;a._destroyed||(c.remove(f,m,b),c.remove(f,n,b),c.remove(f,o,b),b.stop(),a._containerIsNotDocument&&(d=a.get("container"),c.remove(d,m,b),c.remove(d,n,b)))},resume:function(){var d,a=this,b=a._loadFn;a._destroyed||(c.on(f,m,b),c.on(f,n,b),c.on(f,o,b),a._containerIsNotDocument&&(d=a.get("container"),c.on(d,m,b),c.on(d,n,b)))},destroy:function(){var b=this;b.pause(),b._callbacks={},a.log("datalazyload is destroyed!"),b.fire("destroy"),b._destroyed=1}}),A.loadCustomLazyData=E,a.DataLazyload=A,A},{requires:["dom","event","base"]});